import{A as e,D as t,a as n,m as r}from"./index-DDlBfFDj.js";import{i,n as a,r as o}from"./src-D4TzFAvY.js";const s=Math.abs,c=Math.atan2,l=Math.cos,u=Math.max,d=Math.min,f=Math.sin,p=Math.sqrt,m=Math.PI,h=m/2,g=2*m;function _(e){return e>1?0:e<-1?m:Math.acos(e)}function v(e){return e>=1?h:e<=-1?-h:Math.asin(e)}function y(e){return e.innerRadius}function b(e){return e.outerRadius}function x(e){return e.startAngle}function S(e){return e.endAngle}function C(e){return e&&e.padAngle}function w(e,t,n,r,i,a,o,s){var c=n-e,l=r-t,u=o-i,d=s-a,f=d*c-u*l;if(!(f*f<1e-12))return f=(u*(t-a)-d*(e-i))/f,[e+f*c,t+f*l]}function T(e,t,n,r,i,a,o){var s=e-n,c=t-r,l=(o?a:-a)/p(s*s+c*c),d=l*c,f=-l*s,m=e+d,h=t+f,g=n+d,_=r+f,v=(m+g)/2,y=(h+_)/2,b=g-m,x=_-h,S=b*b+x*x,C=i-a,w=m*_-g*h,T=(x<0?-1:1)*p(u(0,C*C*S-w*w)),E=(w*x-b*T)/S,D=(-w*b-x*T)/S,O=(w*x+b*T)/S,k=(-w*b+x*T)/S,A=E-v,j=D-y,M=O-v,N=k-y;return A*A+j*j>M*M+N*N&&(E=O,D=k),{cx:E,cy:D,x01:-d,y01:-f,x11:E*(i/C-1),y11:D*(i/C-1)}}function E(){var e=y,t=b,n=i(0),r=null,a=x,u=S,E=C,D=null,O=o(k);function k(){var i,o,y=+e.apply(this,arguments),b=+t.apply(this,arguments),x=a.apply(this,arguments)-h,S=u.apply(this,arguments)-h,C=s(S-x),k=S>x;if(D||=i=O(),b<y&&(o=b,b=y,y=o),!(b>1e-12))D.moveTo(0,0);else if(C>g-1e-12)D.moveTo(b*l(x),b*f(x)),D.arc(0,0,b,x,S,!k),y>1e-12&&(D.moveTo(y*l(S),y*f(S)),D.arc(0,0,y,S,x,k));else{var A=x,j=S,M=x,N=S,P=C,F=C,I=E.apply(this,arguments)/2,L=I>1e-12&&(r?+r.apply(this,arguments):p(y*y+b*b)),R=d(s(b-y)/2,+n.apply(this,arguments)),z=R,B=R,V,H;if(L>1e-12){var U=v(L/y*f(I)),W=v(L/b*f(I));(P-=U*2)>1e-12?(U*=k?1:-1,M+=U,N-=U):(P=0,M=N=(x+S)/2),(F-=W*2)>1e-12?(W*=k?1:-1,A+=W,j-=W):(F=0,A=j=(x+S)/2)}var G=b*l(A),K=b*f(A),q=y*l(N),J=y*f(N);if(R>1e-12){var Y=b*l(j),X=b*f(j),Z=y*l(M),Q=y*f(M),$;if(C<m)if($=w(G,K,Z,Q,Y,X,q,J)){var ee=G-$[0],te=K-$[1],ne=Y-$[0],re=X-$[1],ie=1/f(_((ee*ne+te*re)/(p(ee*ee+te*te)*p(ne*ne+re*re)))/2),ae=p($[0]*$[0]+$[1]*$[1]);z=d(R,(y-ae)/(ie-1)),B=d(R,(b-ae)/(ie+1))}else z=B=0}F>1e-12?B>1e-12?(V=T(Z,Q,G,K,b,B,k),H=T(Y,X,q,J,b,B,k),D.moveTo(V.cx+V.x01,V.cy+V.y01),B<R?D.arc(V.cx,V.cy,B,c(V.y01,V.x01),c(H.y01,H.x01),!k):(D.arc(V.cx,V.cy,B,c(V.y01,V.x01),c(V.y11,V.x11),!k),D.arc(0,0,b,c(V.cy+V.y11,V.cx+V.x11),c(H.cy+H.y11,H.cx+H.x11),!k),D.arc(H.cx,H.cy,B,c(H.y11,H.x11),c(H.y01,H.x01),!k))):(D.moveTo(G,K),D.arc(0,0,b,A,j,!k)):D.moveTo(G,K),!(y>1e-12)||!(P>1e-12)?D.lineTo(q,J):z>1e-12?(V=T(q,J,Y,X,y,-z,k),H=T(G,K,Z,Q,y,-z,k),D.lineTo(V.cx+V.x01,V.cy+V.y01),z<R?D.arc(V.cx,V.cy,z,c(V.y01,V.x01),c(H.y01,H.x01),!k):(D.arc(V.cx,V.cy,z,c(V.y01,V.x01),c(V.y11,V.x11),!k),D.arc(0,0,y,c(V.cy+V.y11,V.cx+V.x11),c(H.cy+H.y11,H.cx+H.x11),k),D.arc(H.cx,H.cy,z,c(H.y11,H.x11),c(H.y01,H.x01),!k))):D.arc(0,0,y,N,M,k)}if(D.closePath(),i)return D=null,i+``||null}return k.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+a.apply(this,arguments)+ +u.apply(this,arguments))/2-m/2;return[l(r)*n,f(r)*n]},k.innerRadius=function(t){return arguments.length?(e=typeof t==`function`?t:i(+t),k):e},k.outerRadius=function(e){return arguments.length?(t=typeof e==`function`?e:i(+e),k):t},k.cornerRadius=function(e){return arguments.length?(n=typeof e==`function`?e:i(+e),k):n},k.padRadius=function(e){return arguments.length?(r=e==null?null:typeof e==`function`?e:i(+e),k):r},k.startAngle=function(e){return arguments.length?(a=typeof e==`function`?e:i(+e),k):a},k.endAngle=function(e){return arguments.length?(u=typeof e==`function`?e:i(+e),k):u},k.padAngle=function(e){return arguments.length?(E=typeof e==`function`?e:i(+e),k):E},k.context=function(e){return arguments.length?(D=e??null,k):D},k}function D(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function O(e){return e}function k(){var e=O,t=D,n=null,r=i(0),o=i(g),s=i(0);function c(i){var c,l=(i=a(i)).length,u,d,f=0,p=Array(l),m=Array(l),h=+r.apply(this,arguments),_=Math.min(g,Math.max(-g,o.apply(this,arguments)-h)),v,y=Math.min(Math.abs(_)/l,s.apply(this,arguments)),b=y*(_<0?-1:1),x;for(c=0;c<l;++c)(x=m[p[c]=c]=+e(i[c],c,i))>0&&(f+=x);for(t==null?n!=null&&p.sort(function(e,t){return n(i[e],i[t])}):p.sort(function(e,n){return t(m[e],m[n])}),c=0,d=f?(_-l*b)/f:0;c<l;++c,h=v)u=p[c],x=m[u],v=h+(x>0?x*d:0)+b,m[u]={data:i[u],index:c,value:x,startAngle:h,endAngle:v,padAngle:y};return m}return c.value=function(t){return arguments.length?(e=typeof t==`function`?t:i(+t),c):e},c.sortValues=function(e){return arguments.length?(t=e,n=null,c):t},c.sort=function(e){return arguments.length?(n=e,t=null,c):n},c.startAngle=function(e){return arguments.length?(r=typeof e==`function`?e:i(+e),c):r},c.endAngle=function(e){return arguments.length?(o=typeof e==`function`?e:i(+e),c):o},c.padAngle=function(e){return arguments.length?(s=typeof e==`function`?e:i(+e),c):s},c}const A=[{id:null,name:`現金`,shares:1,price:32634,cost:32634},{id:`2330.TW`,name:`台積電`,shares:167,price:1450,cost:899.31},{id:`00757.TW`,name:`統一FANG+`,shares:934,price:116,cost:100},{id:`00675L.TW`,name:`富邦臺灣加權正二`,shares:5835,price:130.2,cost:81.01},{id:`00713.TW`,name:`元大台灣高息低波`,shares:422,price:51.4,cost:53.51}];var j=`myStockMap_holdings`;const M=n(`portfolio`,()=>{let n=localStorage.getItem(j),i=e(n?JSON.parse(n):A);function a(){i.value.forEach(e=>{e.id=e.id||null,e.name=e.name||e.id,e.shares=Number(e.shares)||0,e.price=Number(e.price)||0,e.cost=Number(e.cost)||0,e.stockValue=Number(e.shares*e.price||0)})}a(),t(i,e=>{try{localStorage.setItem(j,JSON.stringify(e))}catch(e){console.warn(`存 localStorage 失敗`,e)}},{deep:!0});function o(e){let t=i.value.findIndex(t=>t.id===e.id),n={id:e.id,name:e.name||e.id,shares:Number(e.shares)||0,price:Number(e.price)||0,cost:Number(e.cost)||0};n.stockValue=n.shares*n.price,t===-1?i.value.push(n):i.value[t]={...i.value[t],...n}}function s(e){i.value=i.value.filter(t=>t.id!==e)}function c(){i.value=[]}let l=r(()=>i.value.reduce((e,t)=>e+(Number(t.stockValue)||0),0)),u=r(()=>i.value.filter(e=>e.id!==null).reduce((e,t)=>e+(Number(t.stockValue)||0),0)),d=r(()=>i.value.reduce((e,t)=>e+(Number(t.cost)*Number(t.shares)||0),0)),f=r(()=>d.value?(l.value-d.value)/d.value:0);function p(e){let t=!1;return i.value.forEach(n=>{e[n.id]!=null&&(n.price=Number(e[n.id]),n.stockValue=n.price*n.shares,t=!0)}),t}return{holdingDetailsData:i,addOrUpdateHolding:o,removeHolding:s,clearHoldings:c,recalcValues:a,updatePrices:p,totalValue:l,totalValueExCash:u,totalCost:d,overallReturnPercent:f}});export{k as n,E as r,M as t};