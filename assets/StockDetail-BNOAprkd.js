import{A as e,C as t,D as n,E as r,M as i,P as a,S as o,T as s,b as c,f as l,h as u,m as d,n as f,v as p,w as m,x as h}from"./index-DDlBfFDj.js";import{C as g,F as ee,I as _,L as v,N as y,P as b,V as x,_ as S,f as C,k as w,m as T,o as E,s as D,t as te,z as O}from"./src-D4TzFAvY.js";import{n as k,t as A}from"./mockData2330-DspHy-s9.js";import{t as j}from"./monotone-D6T-dG_O.js";import{i as ne,n as M,r as re,t as ie}from"./stocksApi-BLkAgOn_.js";var N={class:`mt-4 grid grid-cols-2 sm:grid-cols-4 gap-3`},ae={class:`text-xs text-[color:var(--color-secondary)]`},P={class:`text-lg font-semibold mt-1`},oe={__name:`IndicatorSummaryCards`,props:{indicatorSummaryData:{type:Array,default:()=>[]}},setup(t){let i=t,o=e({"MA(20)":`-`,"MA(50)":`-`,RSI:`-`,"Vol Avg":`-`});function c(e,t){if(!Array.isArray(e)||e.length<t)return null;let n=0;for(let r=e.length-t;r<e.length;r++)n+=e[r];return n/t}function d(e){if(!Array.isArray(e)||e.length===0)return null;let t=e.filter(e=>Number.isFinite(e));return t.length===0?null:t.reduce((e,t)=>e+t,0)/t.length}let f=(e,t=2)=>e==null||Number.isNaN(e)?`-`:Number(e).toFixed(t);function m(e){return e==null?`-`:e>=1e9?(e/1e9).toFixed(2)+`B`:e>=1e6?(e/1e6).toFixed(2)+`M`:e>=1e3?(e/1e3).toFixed(2)+`k`:Math.round(e).toLocaleString()}function h(e){if(!e)return null;let t=e.map(e=>e.close);if(t.length<15)return null;let n=0,r=0;for(let e=1;e<=14;e++){let i=t[e]-t[e-1];i>0?n+=i:r-=i}let i=n/14,a=r/14;for(let e=15;e<t.length;e++){let n=t[e]-t[e-1],r=n>0?n:0,o=n<0?-n:0;i=(i*13+r)/14,a=(a*13+o)/14}return i===0&&a===0?50:a===0?100:100-100/(1+i/a)}function g(e){if(!e||e.length===0){o.value={"MA(20)":`-`,"MA(50)":`-`,RSI:`-`,"Vol Avg":`-`};return}let t=e.map(e=>e.close),n=e.map(e=>e.volume),r=c(t,20),i=c(t,50),a=h(e),s=d(n.filter(e=>e>0));o.value={"MA(20)":f(r),"MA(50)":f(i),RSI:f(a),"Vol Avg":m(s)}}return n(()=>i.indicatorSummaryData,e=>g(e),{immediate:!0,deep:!0}),(e,t)=>(s(),p(`div`,N,[(s(!0),p(l,null,r(o.value,(e,t)=>(s(),p(`div`,{key:t,class:`p-3 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)] text-center`},[u(`div`,ae,a(t),1),u(`div`,P,a(e),1)]))),128))]))}},se={class:`lg:col-span-2 card-theme rounded-2xl shadow p-4`},ce={class:`flex items-center justify-between mb-3`},le={class:`font-medium text-[color:var(--color-secondary)]`},ue={class:`text-xs text-[color:var(--color-secondary)]`},F=1990,de=1e3,I={__name:`PriceChartCard`,props:{currentTimeframe:String,lastUpdated:Date},setup(r){let i=r,c=e(!1),M=f(),N=d(()=>M.symbol),ae=d(()=>M.displaySymbol),P=e(null),I=e(null),L=e(null),R=d(()=>i.currentTimeframe),z=e(R.value),B=e([]);function V(e,t,n=F){switch(e){case`7D`:return S.offset(t,-7);case`1M`:return S.offset(t,-30);case`3M`:return T.offset(t,-3);case`1Y`:return C.offset(t,-1);case`3Y`:return C.offset(t,-3);case`max`:return new Date(n,0,1);default:return S.offset(t,-30)}}let H=e(0),U=e(0),W=new Map,G=0;function K(e,t){return`${e}|${t.startYear}-${t.startMonth}~${t.endYear}-${t.endMonth}`}function q(e){let t=new Date,n={endYear:t.getFullYear(),endMonth:t.getMonth()+1},r=V(e,t,F);return{startYear:r.getFullYear(),startMonth:r.getMonth()+1,...n}}async function J(e={}){c.value=!0;let t=K(N.value,e);if(W.has(t)){let e=W.get(t);if(B.value===e){c.value=!1;return}B.value=e,c.value=!1;return}let n=++G;try{let r=await ie(N.value,e);if(n!==G)return;W.set(t,r),B.value=r,X.value=t,console.log(`✅ 從後端取得 ${N.value} 資料`,r.length,e)}catch(e){if(n!==G)return;console.warn(`⚠️ 無法連線伺服器，改用 mockData2330：`,e.message),B.value=/^2330(?:\.TW)?$/i.test(ae.value)?re(N.value,A):[]}finally{n===G&&(c.value=!1)}}let Y=d(()=>{let e=B.value.at(-1)?.date||new Date,t=B.value.length?V(z.value,e,F):new Date(0);return B.value.filter(e=>e.high!==null).filter(e=>e.date>=t)});function fe(e){if(!B.value.length)return!1;let t=B.value.at(-1)?.date||new Date,n=V(e,t,F);return B.value[0].date<=n}let X=e(``);n(R,async e=>{if(fe(e)){z.value=e;return}let t=q(e),n=K(N.value,t);n!==X.value&&(await J(t),X.value=n),z.value=e});function pe(e){let t=b(I.value);t.selectAll(`*`).remove();let n=P.value.clientWidth,r=P.value.clientHeight,i={top:30,right:20,bottom:40,left:40};H.value=e[0]?.open??0,U.value=e.at(-1)?.close??0;let a=E().domain(O(e,e=>e.date)).range([i.left,n-i.right]).nice(),o=g().domain([k(e,e=>e.low??e.close??e.open),v(e,e=>e.high??e.close??e.open)]).range([r-i.bottom,i.top]).nice(),s=te().x(e=>a(e.date)).y(e=>o(e.close)).curve(j),c=U.value>=H.value?`var(--color-line2)`:`var(--color-line3)`,l=t.append(`path`).datum(e).attr(`fill`,`none`).attr(`stroke`,c).attr(`stroke-width`,2).attr(`d`,s),u=l.node().getTotalLength();l.attr(`stroke-dasharray`,u+` `+u).attr(`stroke-dashoffset`,u).transition().duration(de).ease(w).attr(`stroke-dashoffset`,0);let d=ee(a).ticks(5).tickFormat(D(`%Y/%m/%d`)),f=_(o).ticks(5);t.append(`g`).attr(`transform`,`translate(0, ${r-i.bottom})`).call(d).attr(`color`,`var(--color-text)`).attr(`opacity`,.6),t.append(`g`).attr(`transform`,`translate(${i.left},0)`).call(f).attr(`color`,`var(--color-text)`).attr(`opacity`,.6);let p=b(L.value),m=x(e=>e.date).left,h=t.append(`g`).attr(`class`,`crosshair`).style(`opacity`,0),S=h.append(`line`).attr(`stroke`,`var(--color-border)`).attr(`stroke-width`,1).attr(`y1`,i.top).attr(`y2`,r-i.bottom),C=h.append(`line`).attr(`stroke`,`var(--color-border)`).attr(`stroke-width`,1).attr(`x1`,i.left).attr(`x2`,n-i.left),T=t.append(`circle`).attr(`r`,4).attr(`fill`,c).style(`opacity`,0);t.append(`rect`).attr(`fill`,`transparent`).attr(`width`,n).attr(`height`,r).on(`mousemove`,function(t){let[r]=y(t),i=a.invert(r),s=m(e,i),c=e[Math.min(Math.max(s,0),e.length-1)];h.style(`opacity`,.9),S.transition().duration(80).attr(`x1`,a(c.date)).attr(`x2`,a(c.date)),C.transition().duration(80).attr(`y1`,o(c.close)).attr(`y2`,o(c.close)),T.transition().duration(80).attr(`cx`,a(c.date)).attr(`cy`,o(c.close)).style(`opacity`,1);let l=a(c.date)+30,u=o(c.close)-70-10;l+160>n&&(l=a(c.date)-160+40),u<0&&(u=o(c.close)+10),p.html(`
                            <div><strong>${D(`%Y/%m/%d`)(c.date)}</strong></div>
                            <div>高價: ${c.high.toLocaleString()}</div>
                            <div>低價: ${c.low.toLocaleString()}</div>
                            <div>平盤: ${s>0?e[s-1].close.toLocaleString():`-`}</div>
                          `).transition().duration(150).ease(w).style(`opacity`,1).style(`left`,`${l}px`).style(`top`,`${u}px`)}).on(`mouseleave`,()=>{p.transition().duration(200).style(`opacity`,0),h.transition().duration(150).style(`opacity`,0),T.transition().duration(150).style(`opacity`,0)})}let Z=e(0),Q=new ResizeObserver(()=>{Z.value++});n([Y,Z],([e])=>{!e||e.length<2||o(()=>pe(e))},{immediate:!0});async function $(){await J(q(R.value)),z.value=R.value}return n(()=>N.value,()=>{$()}),d(()=>{let e=B.value.at(-1);return e&&typeof e.volume==`number`?e.volume:null}),d(()=>!U.value||!H.value?0:(U.value-H.value)/H.value),m(async()=>{Q.observe(P.value),await $()}),t(()=>{Q.disconnect()}),(e,t)=>(s(),p(l,null,[h(ne,{open:c.value,message:`價格資料載入中`},null,8,[`open`]),u(`div`,se,[u(`div`,ce,[u(`div`,le,`價格走勢（`+a(i.currentTimeframe)+`）`,1),u(`div`,ue,`最後更新：`+a(i.lastUpdated.toLocaleString()),1)]),u(`div`,{ref_key:`chartContainerRef`,ref:P,class:`relative h-72 md:h-96 rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-card)] flex items-center justify-center text-[color:var(--color-secondary)] opacity-70`},[(s(),p(`svg`,{ref_key:`svgRef`,ref:I,class:`w-full h-full`},null,512)),u(`div`,{ref_key:`tooltipRef`,ref:L,class:`absolute bg-[color:var(--color-card)] border border-[color:var(--color-border)] text-[color:var(--color-text)] text-xs px-2 py-1 rounded shadow opacity-0 transition-opacity duration-200 pointer-events-none`},null,512)],512),h(oe,{"indicator-summary-data":Y.value},null,8,[`indicator-summary-data`])])],64))}},L={class:`card-theme rounded-2xl shadow p-4 space-y-4`},R={class:`text-sm space-y-1 text-[color:var(--color-text)] mt-2`},z={class:`font-medium text-[color:var(--color-primary)]`},B={class:`font-medium text-[color:var(--color-primary)]`},V={class:`font-medium text-[color:var(--color-primary)]`},H={class:`font-medium text-[color:var(--color-primary)]`},U={class:`font-medium text-[color:var(--color-primary)]`},W={class:`border-t border-[color:var(--color-border)] pt-3`},G={class:`text-sm space-y-1 text-[color:var(--color-secondary)] mt-2`},K={class:`font-medium`},q={class:`font-medium`},J={class:`border-t border-[color:var(--color-border)] pt-3`},Y={class:`space-y-2.5`},fe={__name:`InformationSummary`,props:{ticker:String,fundamentalSummary:Object,holdingSummary:Object,holdingSummaryPL:[String,Number],holdingSummaryPLClass:String},emits:[`copy-ticker`],setup(e){let t=e;return(e,n)=>(s(),p(`div`,L,[u(`div`,null,[n[6]||=u(`h3`,{class:`font-medium text-[color:var(--color-primary)]`},`基本面摘要`,-1),u(`ul`,R,[u(`li`,null,[n[1]||=c(`本益比（PE）：`,-1),u(`span`,z,a(t.fundamentalSummary.peRatio),1)]),u(`li`,null,[n[2]||=c(`股價淨值比（PB）：`,-1),u(`span`,B,a(t.fundamentalSummary.pbRatio),1)]),u(`li`,null,[n[3]||=c(`殖利率：`,-1),u(`span`,V,a((t.fundamentalSummary.yield*100).toFixed(1))+`%`,1)]),u(`li`,null,[n[4]||=c(`股本：`,-1),u(`span`,H,a((t.fundamentalSummary.shareCapital/10**8).toLocaleString())+` 億`,1)]),u(`li`,null,[n[5]||=c(`EPS（近四季）：`,-1),u(`span`,U,a(t.fundamentalSummary.eps.toLocaleString()),1)])])]),u(`div`,W,[n[10]||=u(`h3`,{class:`font-medium text-[color:var(--color-primary)]`},`個人持倉快速摘要`,-1),u(`ul`,G,[u(`li`,null,[n[7]||=c(`成本： `,-1),u(`span`,K,`$`+a(t.holdingSummary.cost.toLocaleString()),1)]),u(`li`,null,[n[8]||=c(`持股數： `,-1),u(`span`,q,a(t.holdingSummary.shares),1)]),u(`li`,null,[n[9]||=c(`損益： `,-1),u(`span`,{class:i([t.holdingSummaryPLClass,`font-medium`])},`$`+a(t.holdingSummaryPL)+` (-6.21%)`,3)])])]),u(`div`,J,[n[13]||=u(`h4`,{class:`font-medium mb-2`},`更多`,-1),u(`div`,Y,[u(`button`,{onClick:n[0]||=t=>e.$emit(`copy-ticker`),class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)] text-sm cursor-pointer`},` 複製代號 `+a(t.ticker),1),n[11]||=u(`button`,{class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)] text-sm cursor-pointer`},` 查看 PTT 討論這家公司的文章 `,-1),n[12]||=u(`button`,{class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)] text-sm cursor-pointer`},` 查看 Dcard 討論這家公司的文章 `,-1)])])]))}},X={class:`card-theme rounded-2xl shadow p-4`},pe={__name:`HoldingTimelineChart`,setup(t){let n=e(null);return(e,t)=>(s(),p(`div`,X,[t[0]||=u(`h3`,{class:`font-medium mb-3`},`持有時間表`,-1),u(`div`,{ref_key:`containerRef`,ref:n,class:`h-64 flex items-center justify-center text-[color:var(--color-secondary)] opacity-70`},` [個人持有股數折線圖區域 — use D3.js here] `,512)]))}},Z={class:`card-theme rounded-2xl shadow p-4`},Q={class:`space-y-3 text-sm`},$={class:`text-xs text-[color:var(--color-secondary)]`},me={class:`mt-1`},he={__name:`RelevantNews`,props:{notes:Object},setup(e){let t=e;return(e,n)=>(s(),p(`div`,Z,[n[0]||=u(`h3`,{class:`font-medium mb-3`},`相關新聞 / 消息`,-1),u(`ul`,Q,[(s(!0),p(l,null,r(t.notes,(e,t)=>(s(),p(`li`,{key:t,class:`p-3 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},[u(`div`,$,a(e.date),1),u(`div`,me,a(e.text),1)]))),128))])]))}},ge={class:`p-6`},_e={class:`flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6`},ve={class:`flex items-end gap-3`},ye={class:`text-3xl font-bold text-[color:var(--color-primary)]`},be={class:`mr-3 px-2 py-0.5 rounded-md text-xs font-medium bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},xe={class:`text-sm text-[color:var(--color-secondary)]`},Se={class:`mt-2 flex items-baseline gap-4`},Ce={class:`text-xs text-[color:var(--color-secondary)]`},we={class:`flex items-center gap-3`},Te={class:`flex items-center gap-2 bg-[color:var(--color-card)] border border-[color:var(--color-border)] rounded-md p-1`},Ee=[`onClick`],De={class:`grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6`},Oe={class:`grid grid-cols-1 lg:grid-cols-2 gap-6`},ke={__name:`StockDetail`,setup(t){let o=f(),c=d(()=>o.displaySymbol),m=e(`—`),g=e(1),ee=d(()=>g.value<51?`權重股`:``),_=e(`—`),v=e(`-`),y=e(`-`),b=e(new Date),x=e(`-`),S=e(`-`),C=d(()=>Number.isFinite(x.value)?x.value>=0?`+`:`-`:``),w=d(()=>Number.isFinite(x.value)?x.value>=0?`text-red-500`:`text-green-600`:`text-red-500`),T=[`7D`,`1M`,`3M`,`1Y`,`3Y`],E=e(`3M`);async function D(){try{let e=await M(o.symbol);e?(m.value=e.name||`—`,_.value=e.industry||`—`):(m.value=`—`,_.value=`—`);let t=await ie(o.symbol);if(t&&t.length){let e=t.at(-1),n=t.at(-2);if(Number.isFinite(e.close)&&(v.value=e.close),Number.isFinite(e?.volume)&&(y.value=Math.round(e.volume)),e?.date instanceof Date&&!Number.isNaN(+e.date)&&(b.value=e.date),Number.isFinite(n?.close)&&Number.isFinite(e?.close)&&n.close!==0){let t=e.close-n.close;S.value=Number(t),x.value=Number((t/n.close*100).toFixed(2))}}}catch(e){console.warn(`refreshHeadline failed:`,e)}}n(()=>o.symbol,()=>{D()},{immediate:!0});let te=e({peRatio:22.4,pbRatio:5.6,yield:.019,shareCapital:259e9,eps:36.8}),O=e({shares:120,cost:450}),k=d(()=>((v.value-O.value.cost)*O.value.shares).toFixed(0)),A=d(()=>parseFloat(k.value)>=0?`text-green-600`:`text-red-500`);function j(){navigator.clipboard?.writeText(c.value).then(()=>alert(`已複製代號`)).catch(()=>alert(`複製失敗`))}let ne=e([{date:`2025-10-08`,text:`法說會預告 - 影響明日盤勢`},{date:`2025-09-30`,text:`公告除息`}]);return(e,t)=>(s(),p(`div`,ge,[u(`header`,_e,[u(`div`,null,[u(`div`,ve,[u(`div`,ye,a(m.value),1),u(`div`,be,a(c.value),1),u(`div`,xe,` 臺灣市值第 `+a(g.value)+` 大公司｜`+a(ee.value)+`｜`+a(_.value),1)]),u(`div`,Se,[u(`div`,{class:i([w.value,`text-2xl font-bold`])},` $`+a(Number(v.value).toFixed(2)),3),u(`div`,{class:i([w.value,`text-sm font-medium`])},a(C.value)+`$`+a(Math.abs(Number(S.value)).toFixed(2))+` / `+a(C.value)+a(Math.abs(Number(x.value)).toFixed(2))+`% `,3),u(`div`,Ce,a(b.value.toLocaleString(`zh-TW`,{month:`2-digit`,day:`numeric`}))+` 成交量 `+a(y.value.toLocaleString()),1)])]),u(`div`,we,[u(`div`,Te,[(s(),p(l,null,r(T,e=>u(`button`,{key:e,onClick:t=>E.value=e,class:i([`px-3 py-1 rounded-md text-sm transition cursor-pointer`,E.value===e?`bg-[color:var(--color-primary)] text-white`:``])},a(e),11,Ee)),64))]),t[0]||=u(`button`,{class:`px-3 py-1 rounded-md border border-[color:var(--color-border)] bg-[color:var(--color-card)] text-sm`},`新增觀察`,-1)])]),u(`div`,De,[h(I,{"current-timeframe":E.value,"last-updated":b.value},null,8,[`current-timeframe`,`last-updated`]),h(fe,{ticker:c.value,"fundamental-summary":te.value,"holding-summary":O.value,"holding-summary-p-l":k.value,"holding-summary-p-l-class":A.value,onCopyTicker:j},null,8,[`ticker`,`fundamental-summary`,`holding-summary`,`holding-summary-p-l`,`holding-summary-p-l-class`])]),u(`div`,Oe,[h(pe),h(he,{notes:ne.value},null,8,[`notes`])])]))}};export{ke as default};