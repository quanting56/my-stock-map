import{P as e,T as t,_ as n,g as r,h as i,i as a,p as o}from"./index-DDlBfFDj.js";var s={role:`dialog`,"aria-busy":`true`,"aria-live":`polite`,class:`fixed inset-0 bg-gray-950/50 flex flex-col items-center justify-center z-[999]`},c={class:`mt-4 text-gray-50`},l={__name:`LoadingModal`,props:{open:{type:Boolean,default:!1},message:{type:String,default:`資料讀取中`}},setup(a){return(l,u)=>a.open?(t(),r(o,{key:0,to:`body`},[i(`div`,s,[u[0]||=i(`div`,{class:`h-12 w-12 rounded-full border-4 border-gray-400 border-t-blue-500 animate-spin`},null,-1),i(`p`,c,e(a.message)+`，請稍候…`,1)])])):n(``,!0)}};async function u(e,t={}){let n=new URLSearchParams(t).toString(),r=`http://localhost:3000/api/stocks/${e}${n?`?`+n:``}`,i=await fetch(r);if(!i.ok)throw Error(`後端回傳錯誤：${i.status}`);return i.json()}function d(e=``,t=[]){let n=e=>{if(e==null)return null;if(typeof e==`number`)return e;let t=Number(String(e).replace(/,/g,``));return Number.isFinite(t)?t:null},r=e=>{if(e instanceof Date)return e;if(typeof e!=`string`)return null;let t=e.replace(/\//g,`-`),n=new Date(t);return Number.isNaN(+n)?null:n};return t.map(t=>{let i=r(t.date),a=n(t.open),o=n(t.high),s=n(t.low),c=n(t.close),l=n(t.volume)??0,u=t.adjClose==null?c??null:n(t.adjClose);return i&&a!=null&&o!=null&&s!=null&&c!=null?{symbol:e,date:i,open:a,high:o,low:s,close:c,adjClose:u,volume:l}:null}).filter(Boolean).sort((e,t)=>e.date-t.date)}async function f(e,t={}){let n=await u(e,t);return d(e,n)}async function p(e){let t=String(e).toUpperCase().replace(/\.TW$/,``).trim();try{let e=await fetch(`http://localhost:3000/api/symbols/${t}`);if(e.status===404)return null;if(!e.ok)throw Error(`後端回傳錯誤：${e.status}`);return e.json()}catch{}try{let{default:e}=await a(async()=>{let{default:e}=await import(`./mockDataCompanyName-d-8Egcsd.js`);return{default:e}},[]),n={twse:`上市`,tpex:`上櫃`},r=(Array.isArray(e?.data)?e.data:[]).find(e=>String(e.stock_id)===t);return r?{code:String(r.stock_id),symbol:`${r.stock_id}.TW`,name:String(r.stock_name),market:n[r.type?.toLowerCase?.()]??r.type??``,industry:r.industry_category??``}:null}catch{return null}}export{l as i,p as n,d as r,f as t};