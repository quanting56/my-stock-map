import{C as e,S as t,_ as n,a as r,c as i,d as a,g as o,h as s,l as c,o as l,p as u,s as d,t as f,u as p,v as ee,y as m}from"./index-BvHIBcQ7.js";var te={class:`p-6`},ne={class:`flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6`},re={class:`flex flex-wrap gap-3 items-center`},ie=[`value`],ae=[`disabled`],h={class:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6`},oe={class:`card-theme rounded-2xl shadow p-4 text-center`},se={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},ce={class:`card-theme rounded-2xl shadow p-4 text-center`},le={class:`text-2xl font-bold mt-2 text-[color:var(--color-line2)]`},ue={class:`card-theme rounded-2xl shadow p-4 text-center`},de={class:`text-2xl font-bold mt-2 text-[color:var(--color-line3)]`},fe={class:`card-theme rounded-2xl shadow p-4 text-center`},pe={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},me={class:`grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6`},he={class:`lg:col-span-2 card-theme rounded-2xl shadow p-4`},g={class:`flex items-center justify-between mb-3`},_={class:`font-medium text-[color:var(--color-secondary)]`},v={class:`text-xs text-[color:var(--color-secondary)]`},y={class:`h-64 md:h-80 rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-card)] flex items-center justify-center text-[color:var(--color-secondary)] opacity-70`},b={key:1,class:`w-full h-full flex flex-col`},x={class:`flex-1 flex items-end px-3 py-2`},S={class:`w-full flex items-end gap-1`},C=[`title`],w={class:`mt-3 grid grid-cols-2 gap-3 text-xs text-[color:var(--color-secondary)]`},T={class:`text-right`},E={class:`card-theme rounded-2xl shadow p-4 space-y-4`},D={class:`mt-2 text-sm text-[color:var(--color-secondary)] space-y-2`},O={class:`font-medium ml-2`},k={class:`font-medium ml-2`},A={class:`font-medium ml-2`},j={class:`font-medium ml-2`},M={class:`border-t border-[color:var(--color-border)] pt-3`},N={class:`text-sm text-[color:var(--color-secondary)] space-y-1`},P={class:`font-medium ml-2`},F={class:`font-medium ml-2`},I={class:`font-medium ml-2`},L={class:`font-medium ml-2`},R={class:`grid grid-cols-1 lg:grid-cols-2 gap-6`},ge={class:`card-theme rounded-2xl shadow p-4 overflow-auto`},_e={class:`w-full text-sm`},ve={key:0},ye={class:`py-2`},be={class:`text-right`},xe={class:`text-right`},Se={class:`card-theme rounded-2xl shadow p-4`},Ce={class:`text-sm text-[color:var(--color-secondary)] space-y-2`},we={key:0,class:`text-[color:var(--color-secondary)]`},z=f({__name:`Backtest`,setup(f){let z=[{id:`ma-cross`,name:`均線交叉 (MA Cross)`},{id:`momentum`,name:`Momentum`},{id:`mean-revert`,name:`均值回歸`}],B=ee({strategy:z[0].id,startDate:new Date(new Date().getFullYear()-1,0,1).toISOString().slice(0,10),endDate:new Date().toISOString().slice(0,10),initialCapital:1e5}),V=m(!1),H=m([]),U=m([]),W=m([]);function G(e){return e==null?`-`:`$${Number(e).toLocaleString()}`}let K=i(()=>H.value.length?H.value[H.value.length-1]:null),q=i(()=>H.value.length?(K.value-B.initialCapital)/B.initialCapital*100:0),J=i(()=>`${q.value.toFixed(2)}%`),Y=i(()=>{if(!H.value.length)return 0;let e=Math.max(1e-4,(new Date(B.endDate)-new Date(B.startDate))/(1e3*60*60*24*365));return((K.value/B.initialCapital)**(1/e)-1)*100}),X=i(()=>isFinite(Y.value)?`${Y.value.toFixed(2)}%`:`-`),Z=i(()=>{if(!H.value.length)return 0;let e=-1/0,t=0;for(let n of H.value){n>e&&(e=n);let r=(e-n)/e;r>t&&(t=r)}return t*100}),Q=i(()=>`${Z.value.toFixed(2)}%`),$=i(()=>{if(H.value.length<2)return`-`;let e=[];for(let t=1;t<H.value.length;t++)e.push(H.value[t]/H.value[t-1]-1);let t=e.reduce((e,t)=>e+t,0)/e.length,n=Math.sqrt(e.map(e=>(e-t)**2).reduce((e,t)=>e+t,0)/e.length);return n===0?`-`:(t/n*Math.sqrt(252)).toFixed(2)}),Te=i(()=>{if(!H.value.length)return[];let e=Math.min(...H.value),t=Math.max(...H.value),n=Math.max(1,t-e);return H.value.map(t=>(t-e)/n)});function Ee(){V.value=!0,W.value=[`開始執行回測：${B.strategy} (${B.startDate} → ${B.endDate})`],U.value=[],H.value=[],setTimeout(()=>{let e=B.initialCapital,t=[];for(let n=0;n<60;n++){let r=(Math.random()-.48)*.02;e=Math.max(100,e*(1+r)),t.push(Number(e.toFixed(2))),Math.random()>.85&&U.value.push({time:new Date(Date.now()-(60-n)*24*3600*1e3).toLocaleString(),side:Math.random()>.5?`Buy`:`Sell`,price:Number((100+Math.random()*50).toFixed(2)),qty:Math.floor(Math.random()*5)+1})}H.value=t,W.value.push(`完成模擬：產生 ${t.length} 個 equity 點與 ${U.value.length} 筆交易`),V.value=!1},800)}function De(){V.value=!1,H.value=[],U.value=[],W.value=[]}function Oe(){let e={params:JSON.parse(JSON.stringify(B)),equity:H.value,trades:U.value,metrics:{totalReturn:q.value,cagr:Y.value,maxDrawdown:Z.value,sharpe:$.value}},t=new Blob([JSON.stringify(e,null,2)],{type:`application/json`}),n=URL.createObjectURL(t),r=document.createElement(`a`);r.href=n,r.download=`backtest_${B.strategy}_${Date.now()}.json`,r.click(),URL.revokeObjectURL(n)}return(i,f)=>(s(),a(`div`,te,[c(`header`,ne,[f[4]||=c(`div`,null,[c(`h1`,{class:`text-2xl font-bold text-[color:var(--color-primary)]`},`🔍 回測模組`),c(`div`,{class:`text-sm text-[color:var(--color-secondary)]`},`模擬策略表現並檢視績效指標`)],-1),c(`div`,re,[n(c(`select`,{"onUpdate:modelValue":f[0]||=e=>B.strategy=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},[(s(),a(d,null,o(z,t=>c(`option`,{key:t.id,value:t.id},e(t.name),9,ie)),64))],512),[[r,B.strategy]]),n(c(`input`,{type:`date`,"onUpdate:modelValue":f[1]||=e=>B.startDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[l,B.startDate]]),n(c(`input`,{type:`date`,"onUpdate:modelValue":f[2]||=e=>B.endDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[l,B.endDate]]),n(c(`input`,{type:`number`,"onUpdate:modelValue":f[3]||=e=>B.initialCapital=e,min:`1`,class:`w-32 px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[l,B.initialCapital,void 0,{number:!0}]]),c(`button`,{onClick:Ee,disabled:V.value,class:`px-4 py-1 rounded-md bg-[color:var(--color-primary)] text-white disabled:opacity-50`},e(V.value?`執行中...`:`執行回測`),9,ae),c(`button`,{onClick:De,class:`px-3 py-1 rounded-md border border-[color:var(--color-border)] bg-[color:var(--color-card)]`},` 重設 `)])]),c(`div`,h,[c(`div`,oe,[f[5]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`總報酬`,-1),c(`div`,se,e(J.value),1)]),c(`div`,ce,[f[6]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`年化 (CAGR)`,-1),c(`div`,le,e(X.value),1)]),c(`div`,ue,[f[7]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`最大回撤`,-1),c(`div`,de,e(Q.value),1)]),c(`div`,fe,[f[8]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`交易次數`,-1),c(`div`,pe,e(U.value.length),1)])]),c(`div`,me,[c(`div`,he,[c(`div`,g,[c(`div`,_,`權益曲線 (`+e(B.strategy)+`)`,1),c(`div`,v,`資本: `+e(G(B.initialCapital)),1)]),c(`div`,y,[H.value.length===0?(s(),a(d,{key:0},[u(` 尚未執行回測 `)],64)):(s(),a(`div`,b,[c(`div`,x,[c(`div`,S,[(s(!0),a(d,null,o(Te.value,(e,n)=>(s(),a(`div`,{key:n,title:G(H.value[n]),style:t({height:`${e*100}%`}),class:`flex-1 rounded-sm bg-gradient-to-t from-[color:var(--color-primary)] to-transparent`},null,12,C))),128))])])]))]),c(`div`,w,[c(`div`,null,`開始: `+e(H.value[0]?G(H.value[0]):`-`),1),c(`div`,T,`結束: `+e(K.value?G(K.value):`-`),1)])]),c(`aside`,E,[c(`div`,null,[f[13]||=c(`h3`,{class:`font-medium text-[color:var(--color-primary)]`},`績效指標`,-1),c(`ul`,D,[c(`li`,null,[f[9]||=u(`年化報酬 (CAGR): `,-1),c(`span`,O,e(X.value),1)]),c(`li`,null,[f[10]||=u(`總報酬: `,-1),c(`span`,k,e(J.value),1)]),c(`li`,null,[f[11]||=u(`最大回撤: `,-1),c(`span`,A,e(Q.value),1)]),c(`li`,null,[f[12]||=u(`夏普比率 (估): `,-1),c(`span`,j,e($.value),1)])])]),c(`div`,M,[f[18]||=c(`h4`,{class:`font-medium mb-2`},`策略參數`,-1),c(`div`,N,[c(`div`,null,[f[14]||=u(`策略：`,-1),c(`span`,P,e(B.strategy),1)]),c(`div`,null,[f[15]||=u(`開始：`,-1),c(`span`,F,e(B.startDate),1)]),c(`div`,null,[f[16]||=u(`結束：`,-1),c(`span`,I,e(B.endDate),1)]),c(`div`,null,[f[17]||=u(`初始資金：`,-1),c(`span`,L,e(G(B.initialCapital)),1)])])]),c(`div`,null,[c(`button`,{onClick:Oe,class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-primary)] text-white`},`匯出結果 (JSON)`)])])]),c(`div`,R,[c(`div`,ge,[f[21]||=c(`h3`,{class:`font-medium mb-3`},`交易紀錄 (模擬)`,-1),c(`table`,_e,[f[20]||=c(`thead`,{class:`text-[color:var(--color-secondary)]`},[c(`tr`,null,[c(`th`,{class:`text-left`},`時間`),c(`th`,{class:`text-left`},`動作`),c(`th`,{class:`text-right`},`價格`),c(`th`,{class:`text-right`},`數量`)])],-1),c(`tbody`,null,[U.value.length===0?(s(),a(`tr`,ve,[...f[19]||=[c(`td`,{colspan:`4`,class:`py-4 text-center text-[color:var(--color-secondary)]`},`尚無交易`,-1)]])):p(``,!0),(s(!0),a(d,null,o(U.value,(t,n)=>(s(),a(`tr`,{key:n,class:`border-t border-[color:var(--color-border)]`},[c(`td`,ye,e(t.time),1),c(`td`,null,e(t.side),1),c(`td`,be,e(G(t.price)),1),c(`td`,xe,e(t.qty),1)]))),128))])])]),c(`div`,Se,[f[22]||=c(`h3`,{class:`font-medium mb-3`},`計算日誌 / 註記`,-1),c(`ul`,Ce,[(s(!0),a(d,null,o(W.value,(t,n)=>(s(),a(`li`,{key:n,class:`p-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},e(t),1))),128)),W.value.length===0?(s(),a(`li`,we,`目前無紀錄`)):p(``,!0)])])])]))}},[[`__scopeId`,`data-v-1a9db864`]]);export{z as default};