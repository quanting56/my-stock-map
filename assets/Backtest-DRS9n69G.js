import{A as e,C as t,D as n,E as r,S as i,T as a,_ as o,d as s,f as c,h as l,j as u,l as d,m as f,o as ee,s as p,t as te}from"./index-DQIx7-PG.js";var ne={class:`p-6`},re={class:`flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6`},ie={class:`flex flex-wrap gap-3 items-center`},ae=[`value`],m=[`disabled`],h={class:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6`},oe={class:`card-theme rounded-2xl shadow p-4 text-center`},se={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},ce={class:`card-theme rounded-2xl shadow p-4 text-center`},le={class:`text-2xl font-bold mt-2 text-[color:var(--color-line2)]`},ue={class:`card-theme rounded-2xl shadow p-4 text-center`},de={class:`text-2xl font-bold mt-2 text-[color:var(--color-line3)]`},fe={class:`card-theme rounded-2xl shadow p-4 text-center`},pe={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},me={class:`grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6`},g={class:`lg:col-span-2 card-theme rounded-2xl shadow p-4`},_={class:`flex items-center justify-between mb-3`},v={class:`font-medium text-[color:var(--color-secondary)]`},y={class:`text-xs text-[color:var(--color-secondary)]`},b={class:`h-64 md:h-80 rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-card)] flex items-center justify-center text-[color:var(--color-secondary)] opacity-70`},x={key:1,class:`w-full h-full flex flex-col`},S={class:`flex-1 flex items-end px-3 py-2`},C={class:`w-full flex items-end gap-1`},w=[`title`],T={class:`mt-3 grid grid-cols-2 gap-3 text-xs text-[color:var(--color-secondary)]`},E={class:`text-right`},D={class:`card-theme rounded-2xl shadow p-4 space-y-4`},O={class:`mt-2 text-sm text-[color:var(--color-secondary)] space-y-2`},k={class:`font-medium ml-2`},A={class:`font-medium ml-2`},j={class:`font-medium ml-2`},M={class:`font-medium ml-2`},N={class:`border-t border-[color:var(--color-border)] pt-3`},P={class:`text-sm text-[color:var(--color-secondary)] space-y-1`},F={class:`font-medium ml-2`},I={class:`font-medium ml-2`},L={class:`font-medium ml-2`},R={class:`font-medium ml-2`},he={class:`grid grid-cols-1 lg:grid-cols-2 gap-6`},ge={class:`card-theme rounded-2xl shadow p-4 overflow-auto`},_e={class:`w-full text-sm`},ve={key:0},ye={class:`py-2`},be={class:`text-right`},xe={class:`text-right`},Se={class:`card-theme rounded-2xl shadow p-4`},Ce={class:`text-sm text-[color:var(--color-secondary)] space-y-2`},we={key:0,class:`text-[color:var(--color-secondary)]`},z=te({__name:`Backtest`,setup(te){let z=[{id:`ma-cross`,name:`均線交叉 (MA Cross)`},{id:`momentum`,name:`Momentum`},{id:`mean-revert`,name:`均值回歸`}],B=r({strategy:z[0].id,startDate:new Date(new Date().getFullYear()-1,0,1).toISOString().slice(0,10),endDate:new Date().toISOString().slice(0,10),initialCapital:1e5}),V=n(!1),H=n([]),U=n([]),W=n([]);function G(e){return e==null?`-`:`$${Number(e).toLocaleString()}`}let K=s(()=>H.value.length?H.value[H.value.length-1]:null),q=s(()=>H.value.length?(K.value-B.initialCapital)/B.initialCapital*100:0),J=s(()=>`${q.value.toFixed(2)}%`),Y=s(()=>{if(!H.value.length)return 0;let e=Math.max(1e-4,(new Date(B.endDate)-new Date(B.startDate))/(1e3*60*60*24*365));return((K.value/B.initialCapital)**(1/e)-1)*100}),X=s(()=>isFinite(Y.value)?`${Y.value.toFixed(2)}%`:`-`),Z=s(()=>{if(!H.value.length)return 0;let e=-1/0,t=0;for(let n of H.value){n>e&&(e=n);let r=(e-n)/e;r>t&&(t=r)}return t*100}),Q=s(()=>`${Z.value.toFixed(2)}%`),$=s(()=>{if(H.value.length<2)return`-`;let e=[];for(let t=1;t<H.value.length;t++)e.push(H.value[t]/H.value[t-1]-1);let t=e.reduce((e,t)=>e+t,0)/e.length,n=Math.sqrt(e.map(e=>(e-t)**2).reduce((e,t)=>e+t,0)/e.length);return n===0?`-`:(t/n*Math.sqrt(252)).toFixed(2)}),Te=s(()=>{if(!H.value.length)return[];let e=Math.min(...H.value),t=Math.max(...H.value),n=Math.max(1,t-e);return H.value.map(t=>(t-e)/n)});function Ee(){V.value=!0,W.value=[`開始執行回測：${B.strategy} (${B.startDate} → ${B.endDate})`],U.value=[],H.value=[],setTimeout(()=>{let e=B.initialCapital,t=[];for(let n=0;n<60;n++){let r=(Math.random()-.48)*.02;e=Math.max(100,e*(1+r)),t.push(Number(e.toFixed(2))),Math.random()>.85&&U.value.push({time:new Date(Date.now()-(60-n)*24*3600*1e3).toLocaleString(),side:Math.random()>.5?`Buy`:`Sell`,price:Number((100+Math.random()*50).toFixed(2)),qty:Math.floor(Math.random()*5)+1})}H.value=t,W.value.push(`完成模擬：產生 ${t.length} 個 equity 點與 ${U.value.length} 筆交易`),V.value=!1},800)}function De(){V.value=!1,H.value=[],U.value=[],W.value=[]}function Oe(){let e={params:JSON.parse(JSON.stringify(B)),equity:H.value,trades:U.value,metrics:{totalReturn:q.value,cagr:Y.value,maxDrawdown:Z.value,sharpe:$.value}},t=new Blob([JSON.stringify(e,null,2)],{type:`application/json`}),n=URL.createObjectURL(t),r=document.createElement(`a`);r.href=n,r.download=`backtest_${B.strategy}_${Date.now()}.json`,r.click(),URL.revokeObjectURL(n)}return(n,r)=>(i(),l(`div`,ne,[c(`header`,re,[r[4]||=c(`div`,null,[c(`h1`,{class:`text-2xl font-bold text-[color:var(--color-primary)]`},`🔍 回測模組`),c(`div`,{class:`text-sm text-[color:var(--color-secondary)]`},`模擬策略表現並檢視績效指標`)],-1),c(`div`,ie,[a(c(`select`,{"onUpdate:modelValue":r[0]||=e=>B.strategy=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},[(i(),l(d,null,t(z,e=>c(`option`,{key:e.id,value:e.id},u(e.name),9,ae)),64))],512),[[ee,B.strategy]]),a(c(`input`,{type:`date`,"onUpdate:modelValue":r[1]||=e=>B.startDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[p,B.startDate]]),a(c(`input`,{type:`date`,"onUpdate:modelValue":r[2]||=e=>B.endDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[p,B.endDate]]),a(c(`input`,{type:`number`,"onUpdate:modelValue":r[3]||=e=>B.initialCapital=e,min:`1`,class:`w-32 px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[p,B.initialCapital,void 0,{number:!0}]]),c(`button`,{onClick:Ee,disabled:V.value,class:`px-4 py-1 rounded-md bg-[color:var(--color-primary)] text-white disabled:opacity-50`},u(V.value?`執行中...`:`執行回測`),9,m),c(`button`,{onClick:De,class:`px-3 py-1 rounded-md border border-[color:var(--color-border)] bg-[color:var(--color-card)]`},` 重設 `)])]),c(`div`,h,[c(`div`,oe,[r[5]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`總報酬`,-1),c(`div`,se,u(J.value),1)]),c(`div`,ce,[r[6]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`年化 (CAGR)`,-1),c(`div`,le,u(X.value),1)]),c(`div`,ue,[r[7]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`最大回撤`,-1),c(`div`,de,u(Q.value),1)]),c(`div`,fe,[r[8]||=c(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`交易次數`,-1),c(`div`,pe,u(U.value.length),1)])]),c(`div`,me,[c(`div`,g,[c(`div`,_,[c(`div`,v,`權益曲線 (`+u(B.strategy)+`)`,1),c(`div`,y,`資本: `+u(G(B.initialCapital)),1)]),c(`div`,b,[H.value.length===0?(i(),l(d,{key:0},[o(` 尚未執行回測 `)],64)):(i(),l(`div`,x,[c(`div`,S,[c(`div`,C,[(i(!0),l(d,null,t(Te.value,(t,n)=>(i(),l(`div`,{key:n,title:G(H.value[n]),style:e({height:`${t*100}%`}),class:`flex-1 rounded-sm bg-gradient-to-t from-[color:var(--color-primary)] to-transparent`},null,12,w))),128))])])]))]),c(`div`,T,[c(`div`,null,`開始: `+u(H.value[0]?G(H.value[0]):`-`),1),c(`div`,E,`結束: `+u(K.value?G(K.value):`-`),1)])]),c(`aside`,D,[c(`div`,null,[r[13]||=c(`h3`,{class:`font-medium text-[color:var(--color-primary)]`},`績效指標`,-1),c(`ul`,O,[c(`li`,null,[r[9]||=o(`年化報酬 (CAGR): `,-1),c(`span`,k,u(X.value),1)]),c(`li`,null,[r[10]||=o(`總報酬: `,-1),c(`span`,A,u(J.value),1)]),c(`li`,null,[r[11]||=o(`最大回撤: `,-1),c(`span`,j,u(Q.value),1)]),c(`li`,null,[r[12]||=o(`夏普比率 (估): `,-1),c(`span`,M,u($.value),1)])])]),c(`div`,N,[r[18]||=c(`h4`,{class:`font-medium mb-2`},`策略參數`,-1),c(`div`,P,[c(`div`,null,[r[14]||=o(`策略：`,-1),c(`span`,F,u(B.strategy),1)]),c(`div`,null,[r[15]||=o(`開始：`,-1),c(`span`,I,u(B.startDate),1)]),c(`div`,null,[r[16]||=o(`結束：`,-1),c(`span`,L,u(B.endDate),1)]),c(`div`,null,[r[17]||=o(`初始資金：`,-1),c(`span`,R,u(G(B.initialCapital)),1)])])]),c(`div`,null,[c(`button`,{onClick:Oe,class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-primary)] text-white`},`匯出結果 (JSON)`)])])]),c(`div`,he,[c(`div`,ge,[r[21]||=c(`h3`,{class:`font-medium mb-3`},`交易紀錄 (模擬)`,-1),c(`table`,_e,[r[20]||=c(`thead`,{class:`text-[color:var(--color-secondary)]`},[c(`tr`,null,[c(`th`,{class:`text-left`},`時間`),c(`th`,{class:`text-left`},`動作`),c(`th`,{class:`text-right`},`價格`),c(`th`,{class:`text-right`},`數量`)])],-1),c(`tbody`,null,[U.value.length===0?(i(),l(`tr`,ve,[...r[19]||=[c(`td`,{colspan:`4`,class:`py-4 text-center text-[color:var(--color-secondary)]`},`尚無交易`,-1)]])):f(``,!0),(i(!0),l(d,null,t(U.value,(e,t)=>(i(),l(`tr`,{key:t,class:`border-t border-[color:var(--color-border)]`},[c(`td`,ye,u(e.time),1),c(`td`,null,u(e.side),1),c(`td`,be,u(G(e.price)),1),c(`td`,xe,u(e.qty),1)]))),128))])])]),c(`div`,Se,[r[22]||=c(`h3`,{class:`font-medium mb-3`},`計算日誌 / 註記`,-1),c(`ul`,Ce,[(i(!0),l(d,null,t(W.value,(e,t)=>(i(),l(`li`,{key:t,class:`p-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},u(e),1))),128)),W.value.length===0?(i(),l(`li`,we,`目前無紀錄`)):f(``,!0)])])])]))}},[[`__scopeId`,`data-v-1a9db864`]]);export{z as default};