import{C as e,O as t,T as n,b as r,d as i,f as a,h as o,k as s,l as c,o as ee,p as l,s as u,t as d,u as f,w as te,x as p}from"./index-BAvwv0or.js";var ne={class:`p-6`},re={class:`flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6`},ie={class:`flex flex-wrap gap-3 items-center`},ae=[`value`],m=[`disabled`],h={class:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6`},oe={class:`card-theme rounded-2xl shadow p-4 text-center`},se={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},ce={class:`card-theme rounded-2xl shadow p-4 text-center`},le={class:`text-2xl font-bold mt-2 text-[color:var(--color-line2)]`},ue={class:`card-theme rounded-2xl shadow p-4 text-center`},de={class:`text-2xl font-bold mt-2 text-[color:var(--color-line3)]`},fe={class:`card-theme rounded-2xl shadow p-4 text-center`},pe={class:`text-2xl font-bold mt-2 text-[color:var(--color-primary)]`},me={class:`grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6`},g={class:`lg:col-span-2 card-theme rounded-2xl shadow p-4`},_={class:`flex items-center justify-between mb-3`},v={class:`font-medium text-[color:var(--color-secondary)]`},y={class:`text-xs text-[color:var(--color-secondary)]`},b={class:`h-64 md:h-80 rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-card)] flex items-center justify-center text-[color:var(--color-secondary)] opacity-70`},x={key:1,class:`w-full h-full flex flex-col`},S={class:`flex-1 flex items-end px-3 py-2`},C={class:`w-full flex items-end gap-1`},w=[`title`],T={class:`mt-3 grid grid-cols-2 gap-3 text-xs text-[color:var(--color-secondary)]`},E={class:`text-right`},D={class:`card-theme rounded-2xl shadow p-4 space-y-4`},O={class:`mt-2 text-sm text-[color:var(--color-secondary)] space-y-2`},k={class:`font-medium ml-2`},A={class:`font-medium ml-2`},j={class:`font-medium ml-2`},M={class:`font-medium ml-2`},N={class:`border-t border-[color:var(--color-border)] pt-3`},P={class:`text-sm text-[color:var(--color-secondary)] space-y-1`},F={class:`font-medium ml-2`},I={class:`font-medium ml-2`},L={class:`font-medium ml-2`},R={class:`font-medium ml-2`},he={class:`grid grid-cols-1 lg:grid-cols-2 gap-6`},ge={class:`card-theme rounded-2xl shadow p-4 overflow-auto`},_e={class:`w-full text-sm`},ve={key:0},ye={class:`py-2`},be={class:`text-right`},xe={class:`text-right`},Se={class:`card-theme rounded-2xl shadow p-4`},Ce={class:`text-sm text-[color:var(--color-secondary)] space-y-2`},we={key:0,class:`text-[color:var(--color-secondary)]`},z=d({__name:`Backtest`,setup(d){let z=[{id:`ma-cross`,name:`均線交叉 (MA Cross)`},{id:`momentum`,name:`Momentum`},{id:`mean-revert`,name:`均值回歸`}],B=te({strategy:z[0].id,startDate:new Date(new Date().getFullYear()-1,0,1).toISOString().slice(0,10),endDate:new Date().toISOString().slice(0,10),initialCapital:1e5}),V=n(!1),H=n([]),U=n([]),W=n([]);function G(e){return e==null?`-`:`$${Number(e).toLocaleString()}`}let K=f(()=>H.value.length?H.value[H.value.length-1]:null),q=f(()=>H.value.length?(K.value-B.initialCapital)/B.initialCapital*100:0),J=f(()=>`${q.value.toFixed(2)}%`),Y=f(()=>{if(!H.value.length)return 0;let e=Math.max(1e-4,(new Date(B.endDate)-new Date(B.startDate))/(1e3*60*60*24*365));return((K.value/B.initialCapital)**(1/e)-1)*100}),X=f(()=>isFinite(Y.value)?`${Y.value.toFixed(2)}%`:`-`),Z=f(()=>{if(!H.value.length)return 0;let e=-1/0,t=0;for(let n of H.value){n>e&&(e=n);let r=(e-n)/e;r>t&&(t=r)}return t*100}),Q=f(()=>`${Z.value.toFixed(2)}%`),$=f(()=>{if(H.value.length<2)return`-`;let e=[];for(let t=1;t<H.value.length;t++)e.push(H.value[t]/H.value[t-1]-1);let t=e.reduce((e,t)=>e+t,0)/e.length,n=Math.sqrt(e.map(e=>(e-t)**2).reduce((e,t)=>e+t,0)/e.length);return n===0?`-`:(t/n*Math.sqrt(252)).toFixed(2)}),Te=f(()=>{if(!H.value.length)return[];let e=Math.min(...H.value),t=Math.max(...H.value),n=Math.max(1,t-e);return H.value.map(t=>(t-e)/n)});function Ee(){V.value=!0,W.value=[`開始執行回測：${B.strategy} (${B.startDate} → ${B.endDate})`],U.value=[],H.value=[],setTimeout(()=>{let e=B.initialCapital,t=[];for(let n=0;n<60;n++){let r=(Math.random()-.48)*.02;e=Math.max(100,e*(1+r)),t.push(Number(e.toFixed(2))),Math.random()>.85&&U.value.push({time:new Date(Date.now()-(60-n)*24*3600*1e3).toLocaleString(),side:Math.random()>.5?`Buy`:`Sell`,price:Number((100+Math.random()*50).toFixed(2)),qty:Math.floor(Math.random()*5)+1})}H.value=t,W.value.push(`完成模擬：產生 ${t.length} 個 equity 點與 ${U.value.length} 筆交易`),V.value=!1},800)}function De(){V.value=!1,H.value=[],U.value=[],W.value=[]}function Oe(){let e={params:JSON.parse(JSON.stringify(B)),equity:H.value,trades:U.value,metrics:{totalReturn:q.value,cagr:Y.value,maxDrawdown:Z.value,sharpe:$.value}},t=new Blob([JSON.stringify(e,null,2)],{type:`application/json`}),n=URL.createObjectURL(t),r=document.createElement(`a`);r.href=n,r.download=`backtest_${B.strategy}_${Date.now()}.json`,r.click(),URL.revokeObjectURL(n)}return(n,d)=>(r(),l(`div`,ne,[i(`header`,re,[d[4]||=i(`div`,null,[i(`h1`,{class:`text-2xl font-bold text-[color:var(--color-primary)]`},`🔍 回測模組`),i(`div`,{class:`text-sm text-[color:var(--color-secondary)]`},`模擬策略表現並檢視績效指標`)],-1),i(`div`,ie,[e(i(`select`,{"onUpdate:modelValue":d[0]||=e=>B.strategy=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},[(r(),l(c,null,p(z,e=>i(`option`,{key:e.id,value:e.id},s(e.name),9,ae)),64))],512),[[ee,B.strategy]]),e(i(`input`,{type:`date`,"onUpdate:modelValue":d[1]||=e=>B.startDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[u,B.startDate]]),e(i(`input`,{type:`date`,"onUpdate:modelValue":d[2]||=e=>B.endDate=e,class:`px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[u,B.endDate]]),e(i(`input`,{type:`number`,"onUpdate:modelValue":d[3]||=e=>B.initialCapital=e,min:`1`,class:`w-32 px-3 py-1 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},null,512),[[u,B.initialCapital,void 0,{number:!0}]]),i(`button`,{onClick:Ee,disabled:V.value,class:`px-4 py-1 rounded-md bg-[color:var(--color-primary)] text-white disabled:opacity-50`},s(V.value?`執行中...`:`執行回測`),9,m),i(`button`,{onClick:De,class:`px-3 py-1 rounded-md border border-[color:var(--color-border)] bg-[color:var(--color-card)]`},` 重設 `)])]),i(`div`,h,[i(`div`,oe,[d[5]||=i(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`總報酬`,-1),i(`div`,se,s(J.value),1)]),i(`div`,ce,[d[6]||=i(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`年化 (CAGR)`,-1),i(`div`,le,s(X.value),1)]),i(`div`,ue,[d[7]||=i(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`最大回撤`,-1),i(`div`,de,s(Q.value),1)]),i(`div`,fe,[d[8]||=i(`h4`,{class:`text-xs text-[color:var(--color-secondary)]`},`交易次數`,-1),i(`div`,pe,s(U.value.length),1)])]),i(`div`,me,[i(`div`,g,[i(`div`,_,[i(`div`,v,`權益曲線 (`+s(B.strategy)+`)`,1),i(`div`,y,`資本: `+s(G(B.initialCapital)),1)]),i(`div`,b,[H.value.length===0?(r(),l(c,{key:0},[o(` 尚未執行回測 `)],64)):(r(),l(`div`,x,[i(`div`,S,[i(`div`,C,[(r(!0),l(c,null,p(Te.value,(e,n)=>(r(),l(`div`,{key:n,title:G(H.value[n]),style:t({height:`${e*100}%`}),class:`flex-1 rounded-sm bg-gradient-to-t from-[color:var(--color-primary)] to-transparent`},null,12,w))),128))])])]))]),i(`div`,T,[i(`div`,null,`開始: `+s(H.value[0]?G(H.value[0]):`-`),1),i(`div`,E,`結束: `+s(K.value?G(K.value):`-`),1)])]),i(`aside`,D,[i(`div`,null,[d[13]||=i(`h3`,{class:`font-medium text-[color:var(--color-primary)]`},`績效指標`,-1),i(`ul`,O,[i(`li`,null,[d[9]||=o(`年化報酬 (CAGR): `,-1),i(`span`,k,s(X.value),1)]),i(`li`,null,[d[10]||=o(`總報酬: `,-1),i(`span`,A,s(J.value),1)]),i(`li`,null,[d[11]||=o(`最大回撤: `,-1),i(`span`,j,s(Q.value),1)]),i(`li`,null,[d[12]||=o(`夏普比率 (估): `,-1),i(`span`,M,s($.value),1)])])]),i(`div`,N,[d[18]||=i(`h4`,{class:`font-medium mb-2`},`策略參數`,-1),i(`div`,P,[i(`div`,null,[d[14]||=o(`策略：`,-1),i(`span`,F,s(B.strategy),1)]),i(`div`,null,[d[15]||=o(`開始：`,-1),i(`span`,I,s(B.startDate),1)]),i(`div`,null,[d[16]||=o(`結束：`,-1),i(`span`,L,s(B.endDate),1)]),i(`div`,null,[d[17]||=o(`初始資金：`,-1),i(`span`,R,s(G(B.initialCapital)),1)])])]),i(`div`,null,[i(`button`,{onClick:Oe,class:`w-full px-3 py-2 rounded-md bg-[color:var(--color-primary)] text-white`},`匯出結果 (JSON)`)])])]),i(`div`,he,[i(`div`,ge,[d[21]||=i(`h3`,{class:`font-medium mb-3`},`交易紀錄 (模擬)`,-1),i(`table`,_e,[d[20]||=i(`thead`,{class:`text-[color:var(--color-secondary)]`},[i(`tr`,null,[i(`th`,{class:`text-left`},`時間`),i(`th`,{class:`text-left`},`動作`),i(`th`,{class:`text-right`},`價格`),i(`th`,{class:`text-right`},`數量`)])],-1),i(`tbody`,null,[U.value.length===0?(r(),l(`tr`,ve,[...d[19]||=[i(`td`,{colspan:`4`,class:`py-4 text-center text-[color:var(--color-secondary)]`},`尚無交易`,-1)]])):a(``,!0),(r(!0),l(c,null,p(U.value,(e,t)=>(r(),l(`tr`,{key:t,class:`border-t border-[color:var(--color-border)]`},[i(`td`,ye,s(e.time),1),i(`td`,null,s(e.side),1),i(`td`,be,s(G(e.price)),1),i(`td`,xe,s(e.qty),1)]))),128))])])]),i(`div`,Se,[d[22]||=i(`h3`,{class:`font-medium mb-3`},`計算日誌 / 註記`,-1),i(`ul`,Ce,[(r(!0),l(c,null,p(W.value,(e,t)=>(r(),l(`li`,{key:t,class:`p-2 rounded-md bg-[color:var(--color-card)] border border-[color:var(--color-border)]`},s(e),1))),128)),W.value.length===0?(r(),l(`li`,we,`目前無紀錄`)):a(``,!0)])])])]))}},[[`__scopeId`,`data-v-1a9db864`]]);export{z as default};